---
title: "Взаимодействие с Telegram"
description: "Создание сессии для работы Шлюза SIP.TG и настройка параметров Telegram-аккаунта."
---

Для работы режима **Шлюз** необходимо подключить обычный Telegram-аккаунт, через который будут проходить звонки. В этом процессе участвуют **две роли**: сессия и администратор.

## Роли

- **Аккаунт сессии** — Telegram-аккаунт, который будет использоваться в качестве источника и получателя звонков. Подключается как **виртуальное устройство** к SIP.TG.
- **Аккаунт администратора** — Telegram-аккаунт, который взаимодействует с [@siptg_bot](https://t.me/siptg_bot?start=utm_docs) и управляет сессией: подключает сессию, может изменять настройки, подключать SIP-АТС и получать уведомления об ошибках.

<Info>
  Один и тот же Telegram-аккаунт может использоваться в обеих ролях. Однако в корпоративной среде рекомендуется разделять их.
</Info>

## Пошаговое подключение сессии

<Steps>
  <Step title="Выбор Telegram-аккаунта">
    Выберите Telegram-аккаунт, который будет использоваться как шлюз. Убедитесь, что он не используется для личных звонков или переписок.
  </Step>
  <Step title="Подключение к боту @siptg_bot">
    Перейдите в [@siptg_bot](https://t.me/siptg_bot?start=utm_docs) и выполните команду `/gateway`. Нажмите кнопку «Подключить».
  </Step>
  <Step title="Выбор хранилища сессии">
    Укажите, где будет храниться сессия:

    - **Облачное хранилище SIP.TG** — просто, быстро и безопасно.
    - **Собственное хранилище** — для компаний с повышенными требованиями к приватности. Подробнее см. [здесь](/docs2/additional/module-storage).
  </Step>
  <Step title="Ввод номера телефона и подтверждение">
    Укажите номер телефона выбранного Telegram-аккаунта. На него поступит код от Telegram, который нужно ввести в бота для авторизации.
  </Step>
</Steps>

<Warning>
  Если на аккаунте включена двухфакторная аутентификация (2FA), будет запущен безопасный процесс восстановления: Telegram отправит письмо на связанный email для сброса пароля. Это делается, чтобы не передавать пароль в открытом виде.
</Warning>

## Применение Telegram настроек к аккаунту

Сразу после подключения сессии бот предложит применить рекомендуемые настройки. Они повышают надёжность и удобство приёма звонков:

- **Отключение звонков на других устройствах** — исключает конфликты, когда вызов поступает одновременно в несколько мест. Позволяет использовать Telegram сессии как канал только для звонков, а остальные устройства — для переписки.
- **Разрешение звонков от всех пользователей** — важно, так как звонки от SIP.TG идут от неизвестных номеров и могут блокироваться настройками Telegram.
- **Разрешение P2P-звонков** — если поддерживается, позволяет Telegram передавать аудио напрямую, без пересылки через серверы, улучшая качество связи и снижая задержки.
- **Запрет на добавление в группы** — снижает риск получения лишних уведомлений, не связанных с задачами звонков.

<Tip>
  Некоторые параметры Telegram можно изменить только спустя **24 часа** после подключения аккаунта. Если получите ошибку — попробуйте снова позже.
</Tip>

## Настройки сессии SIP.TG

### DTMF вх. и DTMF исх.

Эти параметры включают или отключают использование DTMF-клавиатуры в разных направлениях звонков:

- **DTMF вх.** — используется при входящем Telegram-звонке (направление Telegram → SIP);
- **DTMF исх.** — используется при исходящем звонке на Telegram из вашей АТС (направление SIP → Telegram).

DTMF-клавиатура позволяет:

- взаимодействовать с голосовым меню АТС (IVR);
- вводить внутренние номера;
- отображать информацию о звонящем сотруднике при звонке Telegram-пользователю.

Клавиатура активируется свайпом вверх во время разговора. Поддерживаются режимы передачи (RFC2833, inband, SIP INFO) меняются в настройках SIP подключения и должны быть согласованы с настройками АТС.

### Перезвонить и выбор линии

Включает или отключает кнопки «Перезвонить» и «Линии» для Telegram-пользователей, которые взаимодействуют с аккаунтом шлюза. Кнопки появляется в чате после завершения звонка.

Нажатие на кнопку «Перезвонить» инициирует звонок на внутренний номер в АТС, который использовался во время предыдущего разговора, позволяя связать пользователя с конкретным сотрудником или отделом.

Кнопка «Линии» работает примерно также с той лишь разницей, что перед инициированием звонка отображает подключенные линии, через которые можно сделать звонок.

### Обработка сообщений

Включает или отключает возможность реагировать на текстовые сообщения, приходящие в Telegram-аккаунт сессии. При включении открываются дополнительные функции:

- **Callback** — после отправки любого сообщения в чат, пользователь получит входящий звонок от шлюза с последующим соединением с отправленным в сообщении номером (либо номером по умолчанию; поведение настраивается в настройках SIP линии).
- **Inline-бот** — если для сообщения не найден подходящий SIP-аккаунт для звонка, его можно обработать через внешнего inline-бота.
- **Автоответ** — на каждое сообщение отправляется заранее заданный шаблон, например:

  > Этот аккаунт предназначен только для звонков. Для переписки используйте @support_bot.

Эти функции можно включать по отдельности и настраивать поведение в зависимости от ситуации.

Все эти действия настраиваются в разделе `/gateway` → конкретная сессия → «Обработка сообщений».

### Inline-бот

Вы можете подключить собственного inline-бота, который будет использоваться для обработки входящих сообщений. Это особенно полезно в случаях, когда сообщение не может быть сопоставлено с номером телефона или не требуется звонок. Inline-бот может:

- отвечать по шаблону;
- собирать заявки;
- интегрироваться с внешними системами, такими как Helpdesk, CRM и др.

Дополнительно можно задать формат inline-запроса, который будет передаваться боту. Это позволяет структурировать обращение пользователя для более точной обработки. Настраивается через «Обработка сообщений» в интерфейсе бота.

### Расширенные действия

- **Отвязать / Передать** — позволяет снять права администратора с текущего аккаунта или передать их другому Telegram-пользователю (см. [Роли](#роли)).
- **Поделиться подпиской** — распространить действие подписки администратора на эту сессию (см. [Роли](#роли) и [Дополнительные Telegram-аккаунты](/docs2/payment/subscriptions#подписка-«шлюз»)).
- **Отключить** — полностью удалить виртуальное устройство, сбросить сессию и очистить параметры SIP-подключений.